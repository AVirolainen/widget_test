<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Widget Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://gcdn.tranzzo.com/widget/payment-widget.js"></script>
</head>
<body>


<div class="container">
    <script>
        document.getElementById('apiKey').value = "RHQXIF26A4VOBOZMO5E77EEF0FX0LLT5KTA6"
    </script>


    <h1>Payment Widget</h1>

    <div class="mb-3 info-text">
        По замовчуванню ключ API буде "RHQXIF26A4VOBOZMO5E77EEF0FX0LLT5KTA6" від проекту RS_Widget
    </div>


    <form id="widgetForm">
        <div class="mb-3">
            <label for="apiKey" class="form-label">Ключ API:</label>
            <input type="text" class="form-control" id="apiKey" placeholder="Введіть ключ API">
        </div>

        <div class="mb-3">
            <label for="currency" class="form-label">Валюта:</label>
            <select class="form-select" id="currency">
                <option value="UAH">UAH</option>
                <option value="XTS">XTS</option>
                <option value="USD">USD</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="amount" class="form-label">Сума:</label>
            <input type="text" class="form-control" id="amount" value="1" placeholder="Введіть суму" min="0" step="0.01">
        </div>

        <button type="button" class="btn btn-primary init-button" onclick="initWidget()">Ініціювати віджет</button>
    </form>

    <div id="widget" class="mt-4">
        <!-- The payment widget will be embedded here -->
    </div>
</div>

<script>
    function initWidget() {
        const apiKey = document.getElementById('apiKey').value;
        const currency = document.getElementById('currency').value;
        const amount = parseFloat(document.getElementById('amount').value);

        function logToVercel(message) {
            fetch("/api/log", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message }),
            }).catch((error) => console.error("Error sending log:", error));
        }

        logToVercel({apiKey, currency, amount});

        PaymentWidget.init({
            apiKey: apiKey,
            mode: 'embedded',
            selector: '#widget',
            payment: {
                type: 'pay',
                amount: amount,
                currency: currency
            }
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
